<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
 
  <title>qqTimer</title>
  <style type="text/css">
.a {
 color: blue;
 text-decoration: underline;
 cursor: pointer }
.b {
 cursor: pointer }
span.b:hover {
 color: red }
  </style>
  <script type="text/javascript">
<!--
// TODO:
// - allow importing of times
// - cookie for last scramble type
// - worst averages
// - allow importing of scrambles (each line of import is a scramble)
// - mean of 3 => avg of N not counting best/worst K

var startTime;
var curTime;
var inspectionTime;
var timerStatus; // 0 = stopped, 1 = running, 2 = inspecting, 3 = waiting
var times;
var notes;
var comments;
var scrambleArr;
var scramble;
var lastscramble;
var importScrambles=[];
var timerID;
var inspectionID;
var timerupdate = 1;
var highlightStart;
var highlightStop;
var highlightID;
var useMilli = false;
var manualEnter = false;
var showOptions = false;
var timerSize = 2;
var inspection = false;
var penalty = 0;
var usemean3 = false;
var viewstats = true;
var invertedColor = false;

// for multiscrambler
var seq=[];
var p=[];
var ss=[];
var type="333";
var len=25;
var num=1;
var cubesuff=["","'","2"];

// data for all scramblers
var scrdata = [["===WCA PUZZLES===",[["--","blank",0]]],
 ["2x2x2",[["optimal random state","222o",0],["3-gen","2223",25],["6-gen",2226,25]]],
 ["3x3x3",[["old style","333",25]]],
 ["4x4x4",[["SiGN","444",40],["WCA","444wca",40]]],
 ["5x5x5",[["SiGN","555",60],["WCA","555wca",60]]],
 ["6x6x6",[["SiGN","666si",80],["prefix","666p",80],["suffix","666s",80]]],
 ["7x7x7",[["SiGN","777si",100],["prefix","777p",100],["suffix","777s",100]]],
 ["Clock",[["Jaap order","clk",0],["concise","clkc",0],["efficient pin order","clke",0]]],
 ["Megaminx",[["Pochmann","mgmp",70],["old style","mgmo",70]]],
 ["Pyraminx",[["optimal random state","pyro",0],["random moves","pyrm",25]]],
 ["Square-1",[["face turn metric","sq1h",40],["twist metric","sq1t",20]]],
 ["===OTHER PUZZLES===",[["--","blank",0]]],
 ["1x3x3 (Floppy Cube)",[["U D L R","flp",25]]],
 ["2x3x3 (Domino)",[[" ","223",25]]],
 ["3x3x4",[[" ","334",40]]],
 ["3x3x5",[["shapeshifting","335",25]]],
 ["Cmetrick",[[" ","cm3",25]]],
 ["Cmetrick Mini",[[" ","cm2",25]]],
 ["Domino (2x3x3)",[[" ","223",25]]],
 ["Floppy Cube (1x3x3)",[["U D L R","flp",25]]],
 ["FTO (Face-Turning Octahedron)",[[" ","fto",25]]],
 ["Pyraminx Crystal",[["Pochmann","prcp",70],["old style","prco",70]]],
 ["Siamese Cube (1x1x3 block)",[[" ","sia113",25]]],
 ["Siamese Cube (1x2x3 block)",[[" ","sia123",25]]],
 ["Siamese Cube (2x2x2 block)",[[" ","sia222",25]]],
 ["Skewb",[["U L R B","skb",25]]],
 ["Square-2",[[" ","sq2",20]]],
 ["Super Floppy Cube",[[" ","sfl",25]]],
 ["Super Square-1",[["twist metric","ssq1t",20]]],
 ["UFO",[["Jaap style","ufo",25]]],
 ["===SPECIALTY SCRAMBLES===",[["--","blank",0]]],
 ["1x1x1",[["x y z","111",25]]],
 ["3x3x3 subsets",[["2-generator <R,U>","2gen",25],["Roux-generator <M,U>","roux",25],
  ["3-generator <F,R,U>","3gen_F",25],["3-generator <R,U,L>","3gen_L",25],
  ["half turns only","half",25],["last slot + last layer","lsll",15]]],
 ["Bandaged Square-1 </,(1,0)>",[["twist metric","bsq",25]]],
 ["Bigcube subsets",[["<R,r,U,u>","RrUu",40]]],
 ["Relays",[["lots of 3x3x3s","r3",5],["234 relay","r234",0],["2345 relay","r2345",0]]],
 ["===JOKE SCRAMBLES===",[["--","blank",0]]],
 ["-1x-1x-1 (micro style)",[[" ","-1",25]]],
 ["1x1x2",[[" ","112",25]]],
 ["3x3x3 for noobs",[[" ","333noob",25]]],
 ["LOL",[[" ","lol",25]]],
 ["Derrick Eide",[[" ","eide",25]]]];

// statistics
var avgSizes, bestAvg, lastAvg, bestAvgIndex, bestTime, bestTimeIndex, worstTime, worstTimeIndex;

function rescramble() {
 var obj = document.getElementById('optbox');
 var obj2 = document.getElementById('optbox2');

 var box2 = scrdata[obj.selectedIndex][1];
 for (var i=obj2.options.length-1; i>0; i--)
  obj2.remove(i);
 for (var i=0; i<box2.length; i++)
  obj2.options[i] = new Option(box2[i][0],box2[i][1]);
 len = box2[0][2];
 document.getElementById('leng').value = len;
 type = box2[0][1];

 document.getElementById('scramble').innerHTML = "scramble: " + scrambleIt();
}

function rescramble2() {
 var obj = document.getElementById('optbox');
 var obj2 = document.getElementById('optbox2');
 var newType = obj2.options[obj2.selectedIndex].value;

 var box2 = scrdata[obj.selectedIndex][1];
 len = box2[obj2.selectedIndex][2];
 document.getElementById('leng').value = len;
 type = newType;

 document.getElementById('scramble').innerHTML = "scramble: " + scrambleIt();
}

function rescramble3() {
 len = document.getElementById('leng').value;
 document.getElementById('scramble').innerHTML = "scramble: " + scrambleIt();
}

function loadOptBoxes() {
 for (var i=0; i<scrdata.length; i++) {
  document.getElementById('optbox').options[i] = new Option(scrdata[i][0],"");
 }
}

function initialize() {
 loadOptBoxes();

 avgSizes = [3,5,12,100,1000];
 bestAvg = [[-1,0],[-1,0],[-1,0],[-1,0],[-1,0]];
 lastAvg = [[-1,0],[-1,0],[-1,0],[-1,0],[-1,0]];
 bestAvgIndex = [0,0,0,0,0];
 bestTime = -1;
 bestTimeIndex = 0;
 worstTime = -1;
 worstTimeIndex = 0;
 times = [];
 notes = [];
 comments = [];
 scrambleArr = [];
 clearHighlight();
 loadList();
 getStats(true);
 if (timerStatus != 0) {clearInterval(timerID); clearInterval(inspectionID);}
 timerStatus = 3;

 timerupdate = (!getCookie("timerupdate")) ? 1 : getCookie("timerupdate");
 document.getElementById('toggler').innerHTML = (timerupdate==0) ? "on" : (timerupdate==1) ? "on (by seconds)" : "off";
 useMilli = (getCookie("useMilli") == 1) ? true : false;
 document.getElementById('millisec').innerHTML = useMilli ? "1\/100 sec" : "1\/1000 sec";
 manualEnter = (getCookie("manualEnter") == 1) ? true : false;
 document.getElementById('inputTimes').innerHTML = manualEnter ? "with spacebar" : "manually";
 document.getElementById('theTime').innerHTML = manualEnter ?
  "<input id='timeEntry' size=12 style='font-size:100%'>"+
  " <span onclick='stopTimer(13);' class='a'>enter</span>" : "ready";
 timerSize = getCookie("timerSize");
 if (timerSize == null) timerSize = 2;
 document.getElementById('theTime').style.fontSize = timerSize + "em";
 document.getElementById('theList').style.height = Math.max(16, (timerSize * 1.5)) + "em";
 document.getElementById('stats').style.height = Math.max(16, (timerSize * 1.5)) + "em";
 inspection = (getCookie("inspection") == 1) ? true : false;
 document.getElementById('inspec').innerHTML = inspection ? "no" : "WCA";
 usemean3 = (getCookie("usemean3") == 1) ? true : false;
 document.getElementById('mean3').innerHTML = usemean3 ? "don't use" : "use";
 if (getCookie("invertedColor") != invertedColor) invertColor();
 colors = getCookie("color");
 if (colors != null) changeColor(colors);

 curTime = new Date(0);
 document.getElementById('leng').value = len;
 var obj = document.getElementById('optbox');
 for(var i = 0; i < scrdata.length; i++) {
  for (var j = 0; j < scrdata[i][1].length; j++) {
   if(scrdata[i][1][j][1] == type) {
    obj.selectedIndex = i;
    rescramble();
    document.getElementById('optbox2').selectedIndex = j;
   }
  }
 }
 scramble = "";
 rescramble2();
}

function startTimer(keyCode) {
 if (timerStatus == 0 && !manualEnter && keyCode == 32) {
  timerStatus = 3;
 } else if (timerStatus == 3 && !manualEnter && keyCode == 32 && (new Date()).getTime() - curTime.getTime() >= 1000) {
  if (inspection) {
   timerStatus = 2;
   inspectionTime = new Date();
   document.getElementById('theTime').style.color = "red";
   if (timerupdate) {inspectionID = setInterval(updateInspec, (timerupdate==1)?10:100);}
   else {document.getElementById('theTime').innerHTML = "inspection";}
  } else {
   timerStatus = 1;
   startTime = new Date();
   penalty = 0;
   document.getElementById('theTime').style.color = (invertedColor ? "white" : "black");
   if (timerupdate) {timerID = setInterval(updateTimer, (timerupdate==1)?10:100);}
   else {document.getElementById('theTime').innerHTML = "running";}
  }
 } else if (timerStatus == 2 && keyCode == 32) {
  timerStatus = 1;
  startTime = new Date();
  document.getElementById('theTime').style.color = (invertedColor ? "white" : "black");
  var inspecLength = startTime.getTime() - inspectionTime.getTime();
  penalty = (inspecLength < 15000) ? 0 : (inspecLength < 17000) ? 2 : 1;
  if (timerupdate) {
   clearInterval(inspectionID);
   timerID = setInterval(updateTimer, (timerupdate==1)?10:100);
  }
  else {document.getElementById('theTime').innerHTML = "running";}
 }
}

function stopTimer(keyCode) {
 if (keyCode == 32) {
  document.getElementById('optbox').blur();
  document.getElementById('leng').blur();
 }
 if (manualEnter) {
  if (keyCode == 13) {
   var timeStr = document.getElementById('timeEntry').value;
   if (timeStr.match(/.* .*/)) {
    comments[times.length] = timeStr.replace(/.*? (.*)$/, "$1");
    notes[times.length] = 0;
    parseTime(timeStr.replace(/(.*) .*/, "$1"));
   } else {
    parseTime(timeStr);
   }
   document.getElementById('timeEntry').value = "";
   scrambleArr[scrambleArr.length] = scramble;
   rescramble3();
  }
 } else if(timerStatus == 1) {
  timerStatus = (keyCode == 32) ? 0 : 3;
  if (timerupdate) {clearInterval(timerID);}
  getTime(penalty);
  scrambleArr[scrambleArr.length] = scramble;
  rescramble3();
 }
}

function checkKey(keyCode) {
 if (keyCode == 13 || !manualEnter) stopTimer(keyCode);
}

function updateTimer() {
 curTime = new Date();
 var time = curTime.getTime() - startTime.getTime();
 if (timerupdate == 1) {
  document.getElementById('theTime').innerHTML = pretty(time);
 } else {
  document.getElementById('theTime').innerHTML = pretty(time).split(".")[0];
 }
}

function updateInspec() {
 curTime = new Date();
 var time = curTime.getTime() - inspectionTime.getTime();
 document.getElementById('theTime').innerHTML = (time > 17000) ? "DNF" : (time > 15000) ? "+2" : 15-Math.floor(time/1000);
}

function getTime(note) {
 curTime = new Date();
 var time = curTime.getTime() - startTime.getTime();
 times[times.length] = time;
 notes[notes.length] = note;
 comments[comments.length] = "";
 document.getElementById('theTime').innerHTML = pretty(time);
 clearHighlight();
 loadList();
 getStats(false);
}

function parseTime(s) {
 var time = 0;
 var arr = s.split(":");
 if (arr.length == 3) {
  time = 3600000 * parseInt(arr[0]) + 60000 * parseInt(arr[1]) + 1000 * parseFloat(arr[2]);
 } else if (arr.length == 2) {
  time = 60000 * parseInt(arr[0]) + 1000 * parseFloat(arr[1]);
 } else if (arr.length == 1) {
  time = 1000 * parseFloat(arr[0]);
 }
 time = Math.round(time);
 if (isNaN(time)) time = 0;
 if (time != 0) {	// don't insert zero-times
  times[times.length] = time;
  notes[notes.length] = 0;
  comments[comments.length] = "";
  clearHighlight();
  loadList();
  getStats(false);
 }
}

function resetTimes() {
 if (confirm("Are you sure you want to delete ALL of your times?")) {
  initialize();
 }
}

function loadList() {
 var data = [-1], s = "times (<span onclick='resetTimes();' class='a'>reset</span>):<br>"
 // get the best and worst time for the highlighted average
 if (highlightStop != -1 && (highlightStop - highlightStart) > 2) {
  data = getAvg(highlightStart, highlightStop - highlightStart + 1);
 }
 for (var i = 0; i < times.length; i++) {
  if (i == highlightStart) {s += "<span style='background-color: yellow'>";}
  if (i == highlightStart + data[1] || i == highlightStart + data[2]) s += "(";
  var time = times[i];
  if (notes[i] == 0) {s += "<span onclick='del(" + i + ");' class='b'>" + pretty(time);}
  else if (notes[i] == 2) {s += "<span onclick='del(" + i + ");' class='b'>" + pretty(time + 2000) + "+";}
  else {s += "<span onclick='del(" + i + ");' class='b'>DNF(" + pretty(time) + ")";}
  s += (comments[i] ? "[" + comments[i] + "]" : "") + "<\/span>";
  if (i == highlightStart + data[1] || i == highlightStart + data[2]) s += ")";
  if (i == highlightStop) {s += "<\/span>";}
  s += (i == times.length - 1) ? " " : ", ";
 }
 document.getElementById('theList').innerHTML = s;
 // move scrollbar to bottom:
 var window = document.getElementById('theList');
 window.scrollTop = window.scrollHeight;
}

function del(index) {
 if (confirm("Are you sure you want to delete the " +
     pretty((notes[index]==1)?-1:times[index]+1000*notes[index]) + "?")) {
  for (var i = index; i < times.length - 1; i++) {
   times[i] = times[i+1];
   notes[i] = notes[i+1];
   comments[i] = comments[i+1];
   scrambleArr[i] = scrambleArr[i+1];
  }
  times.pop();
  notes.pop();
  comments.pop();
  scrambleArr.pop();
  clearHighlight();
  loadList();
  getStats(true);
 }
}

function getStats(recalc) {
 var numdnf=0, sessionavg, sessionmean;
 if (recalc) {
  var theStats = getAllStats();
  numdnf = theStats[0];
  sessionavg = theStats[1];
  sessionmean = theStats[2];
 } else {
  // update averages and best time / worst time.
  var index = times.length - 1;
  var thisTime = (notes[index] == 1) ? -1 : times[index] + notes[index] * 1000;
  if (bestTime < 0 || (thisTime != -1 && thisTime < bestTime)) {
   bestTime = thisTime;
   bestTimeIndex = index;
  }
  if (thisTime > worstTime) {
   worstTime = thisTime;
   worstTimeIndex = index;
  }
  for (var j = usemean3 ? 0 : 1; j < 5; j++) {
   if (times.length < avgSizes[j]) {
    break;
   } else {
    lastAvg[j] = (j==0) ? getMeanSD(times.length - avgSizes[j], avgSizes[j]) : getAvgSD(times.length - avgSizes[j], avgSizes[j]);
    if (bestAvg[j][0] < 0 || (lastAvg[j][0] != -1 && lastAvg[j][0] < bestAvg[j][0])) {
     bestAvg[j] = lastAvg[j];
     bestAvgIndex[j] = times.length - avgSizes[j];
    }
   }
  }
  var sessionsum = 0;
  for (var i = 0; i < times.length; i++) {
   var thisTime = (notes[i] == 1) ? -1 : times[i] + notes[i] * 1000;
   if (thisTime == -1) {numdnf++;}
   else {sessionsum += thisTime;}
  }
  sessionavg = getAvgSD(0, times.length);
  sessionmean = (numdnf == times.length) ? -1 : (sessionsum / (times.length - numdnf));
 }

 var s = "stats: (<span id='hidestats' onclick='toggleStatView()' class='a'>hide</span>)<br>";
 s += "number of times: " + (times.length - numdnf) + "/" + times.length;
 if (viewstats) {
  s += "<br>best time: <span onclick='setHighlight(" + bestTimeIndex + ",1,0);loadList();' class='a'>";
  s += pretty(bestTime) + "<\/span><br>worst time: <span onclick='setHighlight(" + worstTimeIndex;
  s += ",1,1);loadList();' class='a'>" + pretty(worstTime) + "<\/span><br>";
  if (usemean3 && times.length >= 3) {
   s += "<br>current mean of 3: <span onclick='setHighlight(" + (times.length - 3) + ",3,31);";
   s += "loadList();' class='a'>" + pretty(lastAvg[0][0]) + "<\/span> (&sigma; = " + trim(lastAvg[0][1], 2);
   s += ")<br>best mean of 3: <span onclick='setHighlight(" + bestAvgIndex[0] + ",3,30);loadList();'";
   s += " class='a'>" + pretty(bestAvg[0][0]) + "<\/span> (&sigma; = " + trim(bestAvg[0][1], 2) + ")<br>";
  }
  document.getElementById('stats').innerHTML += avgSizes;
  for (var j = 1; j < 5; j++) {
   if (times.length >= avgSizes[j]) {
    s += "<br>current avg" + avgSizes[j] + ": <span onclick='setHighlight(" + (times.length - avgSizes[j]);
    s += "," + avgSizes[j] + "," + avgSizes[j] + "1);loadList();' class='a'>" + pretty(lastAvg[j][0]);
    s += "<\/span> (&sigma; = " + trim(lastAvg[j][1], 2) + ")<br>";
    s += "best avg" + avgSizes[j] + ": <span onclick='setHighlight(" + bestAvgIndex[j];
    s += "," + avgSizes[j] + "," + avgSizes[j] + "0);loadList();' class='a'>" + pretty(bestAvg[j][0]);
    s += "<\/span> (&sigma; = " + trim(bestAvg[j][1], 2) + ")<br>";
   }
  }
  s += "<br>session avg: <span onclick='setHighlight(0," + times.length + ",2);loadList();' class='a'>";
  s += pretty(sessionavg[0]) + "<\/span> (&sigma; = " + trim(sessionavg[1], 2) + ")<br>session mean: " + pretty(sessionmean);
 }
 document.getElementById('stats').innerHTML = s;
}

function getAllStats() {
 bestAvg = [[-1,0],[-1,0],[-1,0],[-1,0],[-1,0]];
 lastAvg = [[-1,0],[-1,0],[-1,0],[-1,0],[-1,0]];
 bestAvgIndex = [0,0,0,0,0];
 bestTime = -1;
 bestTimeIndex = 0;
 worstTime = -1;
 worstTimeIndex = 0;
 var numdnf = 0;
 var sessionsum = 0;
 for (var i = 0; i < times.length; i++) {
  var thisTime = (notes[i] == 1) ? -1 : times[i] + notes[i] * 1000;
  if (bestTime < 0 || (thisTime != -1 && thisTime < bestTime)) {
   bestTime = thisTime;
   bestTimeIndex = i;
  }
  if (thisTime > worstTime) {
   worstTime = thisTime;
   worstTimeIndex = i;
  }
  if (thisTime == -1) {numdnf++;}
  else {sessionsum += thisTime;}
  // calculate averages
  for (var j = usemean3 ? 0 : 1; j < 5; j++) {
   if (times.length - i < avgSizes[j]) {
    break;
   } else {
    lastAvg[j] = (j==0) ? getMeanSD(i, avgSizes[j]) : getAvgSD(i, avgSizes[j]);
    if (bestAvg[j][0] < 0 || (lastAvg[j][0] != -1 && lastAvg[j][0] < bestAvg[j][0])) {
     bestAvg[j] = lastAvg[j];
     bestAvgIndex[j] = i;
    }
   }
  }
 }
 var sessionavg = getAvgSD(0, times.length);
 var sessionmean = (numdnf == times.length) ? -1 : (sessionsum / (times.length - numdnf));

 return [numdnf, sessionavg, sessionmean];
}

function setHighlight(start, nsolves, id) {
 // if we're trying to set a highlight that has same ID as the current one, clear it.
 if (id == highlightID) {
  clearHighlight();
 } else {
  highlightStart = start;
  highlightStop = start + nsolves - 1;
  highlightID = id;
  if (times.length == 0) return;
  var data = [0,-1,-1];
  if (highlightStop != -1 && (highlightStop - highlightStart) > 1) {
   data = getAvg(highlightStart, highlightStop - highlightStart + 1);
  }
  var s="";
  if (id > 1) {
   s += (id==2)?"Session average":(id==30|id==31)?"Mean of 3":("Average of "+Math.floor(id/10));
   s += ": " + pretty((id==30||id==31)?getMeanSD(start,nsolves)[0]:data[0]) + "<br>";
  }
  for (var i=0; i<nsolves; i++) {
   s += (i+1) + ". ";
   if (i == data[1] || i == data[2]) s += "(";
   s += pretty((notes[start+i]==1)?-1:times[start+i]+notes[start+i]*1000) + ((notes[start+i]==2)?"+":"");
   s += (comments[start+i] ? "[" + comments[start+i] + "]" : "");
   if (i == data[1] || i == data[2]) s += ")";
   s += " &nbsp; " + scrambleArr[start+i] + "<br>";
  }
  document.getElementById('avgdata').innerHTML = "<td colspan='3'>" + s + "<\/td>";
  document.getElementById('avgdata').style.display = "";
 }
}

function clearHighlight() {
 highlightStart = -1;
 highlightStop = -1;
 highlightID = -1;
 document.getElementById('avgdata').style.display = "none";
}

// just gets the average
function getAvg(start, nsolves) {
 if (nsolves < 3) {return [-1,-1,-1];}
 var best = -1;
 var bestindex;
 var worst = -1;
 var worstindex;
 var sum = 0;
 var numdnf = 0;
 // get the average
 for (var j = 0; j < nsolves; j++) {
  var thisTime = (notes[start + j] == 1) ? -1 : times[start + j] + notes[start + j] * 1000;
  if (thisTime == -1) {numdnf++;}
  if (best < 0 || (thisTime != -1 && thisTime < best)) {best = thisTime; bestindex = j;}
  if (j == 0 || thisTime == -1 || (worst != -1 && thisTime > worst)) {worst = thisTime; worstindex = j;}
  sum += thisTime;
 }
 var avg = (sum - best - worst) / (nsolves - 2);
 return [((numdnf < 2) ? avg : -1), bestindex, worstindex];
}

// gets average and SD
function getAvgSD(start, nsolves) {
 var data = getAvg(start, nsolves);
 var variance = 0;
 for (var j = 0; j < nsolves; j++) {
  var thisTime = (notes[start + j] == 1) ? -1 : times[start + j]/1000 + notes[start + j];
  if (j != data[1] && j != data[2]) variance += Math.pow(thisTime - data[0]/1000, 2);
 }
 return [data[0], Math.sqrt(variance / (nsolves - 2.))];
}

function getMeanSD(start, nsolves) {
 var sum = 0, numdnf = 0;
 for (var j = 0; j < nsolves; j++) {
  var thisTime = times[start + j] + notes[start + j] * 1000;
  if (notes[start+j] != 1) {
   sum += thisTime;
   if (thisTime == -1) sum = -1;
  }
  if (notes[start+j] == 1) numdnf++;
 }
 var mean = (numdnf==0) ? sum / nsolves : -1;
 var variance = 0; 
 for (var j = 0; j < nsolves; j++) {
  var thisTime = (notes[start + j] == 1) ? -1 : times[start + j]/1000 + notes[start + j];
  variance += Math.pow(thisTime - mean/1000, 2);
 }
 return [mean, Math.sqrt(variance / nsolves)];
}

function trim(number, nDigits) {
 if (!number || number == Number.POSITIVE_INFINITY || number == Number.NEGATIVE_INFINITY) number = 0;
 var power = Math.pow(10, nDigits);
 var trimmed = "" + Math.round(number * power);
 while (trimmed.length < nDigits + 1) {
  trimmed = "0" + trimmed;
 }
 var len = trimmed.length;
 return trimmed.substr(0,len - nDigits) + "." + trimmed.substr(len - nDigits, nDigits);
}

function pretty(time) {
 if (time < 0) {return "DNF";}
 time = Math.round(time / (useMilli ? 1 : 10));
 var bits = time % (useMilli ? 1000 : 100);
 time = (time - bits) / (useMilli ? 1000 : 100);
 var secs = time % 60;
 var mins = ((time - secs) / 60) % 60;
 var hours = (time - secs - 60 * mins) / 3600;
 var s = "" + bits;
 if (bits < 10) {s = "0" + s;}
 if (bits < 100 && useMilli) {s = "0" + s;}
 s = secs + "." + s;
 if (secs < 10 && (mins > 0 || hours > 0)) {s = "0" + s;}
 if (mins > 0 || hours > 0) {s = mins + ":" + s;}
 if (mins < 10 && hours > 0) {s = "0" + s;}
 if (hours > 0) {s = hours + ":" + s;}
 return s;
}

function changeNotes(i) {
 // 0 is normal solve, 1 is DNF, 2 is +2
 notes[notes.length - 1] = i;
 clearHighlight();
 loadList();
 getStats(true);
}

function getlastscramble() {
 document.getElementById('scramble').innerHTML = "scramble: " + scramble + "<br>last scramble: " + lastscramble;
}

function toggleTimer() {
 stopTimer();
 timerupdate = (timerupdate + 1)%3;
 setCookie("timerupdate", timerupdate);
 document.getElementById('toggler').innerHTML = (timerupdate==0) ? "on" : (timerupdate==1) ? "on (by seconds)" : "off";
}

function toggleMilli() {
 useMilli ^= 1;
 setCookie("useMilli", (useMilli == true ? 1 : 0));
 document.getElementById('millisec').innerHTML = useMilli ? "1\/100 sec" : "1\/1000 sec";
 loadList();
 getStats(true);
}

function toggleInput() {
 if (!manualEnter) stopTimer();
 manualEnter ^= 1;
 setCookie("manualEnter", (manualEnter == true ? 1 : 0));
 document.getElementById('inputTimes').innerHTML = manualEnter ? "with spacebar" : "manually";
 document.getElementById('theTime').innerHTML = manualEnter ?
  "<input id='timeEntry' size=12 style='font-size:100%'>"+
  " <span onclick='stopTimer(13);' class='a'>enter</span>" : "ready";
}

function toggleOptions() {
 showOptions ^= 1;
 document.getElementById('showOpt').innerHTML = showOptions ? "hide" : "show";
 document.getElementById('options').style.display = showOptions ? "" : "none"; 
}

function increaseSize() {
 timerSize++;
 setCookie("timerSize", timerSize);
 document.getElementById('theTime').style.fontSize = timerSize + "em";
 document.getElementById('theList').style.height = Math.max(16, (timerSize * 1.5)) + "em";
 document.getElementById('stats').style.height = Math.max(16, (timerSize * 1.5)) + "em";
}

function decreaseSize() {
 if (timerSize >= 2) timerSize--;
 setCookie("timerSize", timerSize);
 document.getElementById('theTime').style.fontSize = timerSize + "em";
 document.getElementById('theList').style.height = Math.max(16, (timerSize * 1.5)) + "em";
 document.getElementById('stats').style.height = Math.max(16, (timerSize * 1.5)) + "em";
}

function toggleInspection() {
 inspection ^= 1;
 setCookie("inspection", (inspection == true ? 1 : 0));
 document.getElementById('inspec').innerHTML = inspection ? "no" : "WCA";
}

function toggleMean3() {
 usemean3 ^= 1;
 setCookie("usemean3", (usemean3 ? 1 : 0));
 document.getElementById('mean3').innerHTML = usemean3 ? "don't use" : "use";
 getStats(usemean3==1);
}

function toggleStatView() {
 viewstats ^= 1;
 document.getElementById('hidestats').innerHTML = viewstats ? "hide" : "show";
 getStats(viewstats);
}

function invertColor() {
 invertedColor ^= 1;
 setCookie("invertedColor", (invertedColor ? 1 : 0));
 document.bgColor = (invertedColor ? "black" : "white");
 document.body.style.color = (invertedColor ? "white" : "black");

 // change global link color
 var linkCol = (invertedColor ? "#00dadf" : "blue");
 var theRules = [];
 if (document.styleSheets[0].cssRules) theRules = document.styleSheets[0].cssRules;
 else if (document.styleSheets[0].rules) theRules = document.styleSheets[0].rules;
 else return;
 for (var i=0; i<theRules.length; i++) {
  if (theRules[i].style.color)
   theRules[i].style.color = linkCol;
 }
}

function changeColor(str) {
 if (!str) {
  document.getElementById('menu').bgColor = "#" + topcol.value;
  setCookie("color", "#" + topcol.value);
 } else {
  document.getElementById('menu').bgColor = str;
 }
}

function comment() {
 var newComment = prompt("Enter your comment for the most recent solve:",comments[comments.length-1]);
 if (newComment != null) comments[comments.length-1] = newComment;
 document.cookie = name + "=" + value + expires + "; path=/";
}

/* setCookie and getCookie function from http://www.quirksmode.org/js/cookies.html */
function setCookie(name,value) {
 // cookies expire in year 3000 by default
 var expires = "; expires=" + new Date(3000, 00, 01).toGMTString();
 document.cookie = name + "=" + value + expires + "; path=/";
}
function getCookie(name) {
 var nameEQ = name + "=";
 var ca = document.cookie.split(';');
 for(var i=0;i < ca.length;i++) {
  var c = ca[i];
  while (c.charAt(0)==' ') c = c.substring(1,c.length);
  if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
 }
 return null;
}

// Takes a random element of the array x.
function rndEl(x){return x[Math.floor(Math.random()*x.length)];}

function scrambleIt(){
 lastscramble = scramble;
 for (var i=0; i<num; i++) ss[i] = "";
 if(type=="111"){			// 1x1x1
  megascramble([["x"],["y"],["z"]],cubesuff);
 }
 else if(type=="2223"){			// 2x2x2 (3-gen)
  megascramble([["U"],["R"],["F"]],cubesuff);
 }
 else if(type=="2226"){			// 2x2x2 (6-gen)
  megascramble([[["U","D"]],[["R","L"]],[["F","B"]]],cubesuff);
 }
 else if(type=="222o"){			// 2x2x2 (optimal random state)
  get2x2optscramble();
 }
 else if(type=="333"){			// 3x3x3 (old style)
  megascramble([["U","D"],["R","L"],["F","B"]],cubesuff);
 }
 else if(type=="334"){			// 3x3x4
  megascramble([[["U","U'","U2","D","D'","D2"],["u","u'","u2","d","d'","d2"]],[["R2","L2","R2 L2"]],[["F2","B2","F2 B2"]]],[""]);
 }
 else if(type=="335"){			// 3x3x5
  var n;
  megascramble([[["U","U'","U2"], ["D", "D'", "D2"]],["R2","L2"],["F2","B2"]],[""]);
  for(n=0;n<num;n++){ss[n]+=" / ";}
  megascramble([["U","D"],["R","L"],["F","B"]],cubesuff);
 }
 else if(type=="444"){			// 4x4x4 (SiGN)
  megascramble([["U","D","u"],["R","L","r"],["F","B","f"]],cubesuff);
 }
 else if(type=="444wca"){		// 4x4x4 (WCA)
  megascramble([["U","D","Uw"],["R","L","Rw"],["F","B","Fw"]],cubesuff);
 }
 else if(type=="555"){			// 5x5x5 (SiGN)
  megascramble([["U","D","u","d"],["R","L","r","l"],["F","B","f","b"]],cubesuff);
 }
 else if(type=="555wca"){		// 5x5x5 (WCA)
  megascramble([["U","D","Uw","Dw"],["R","L","Rw","Lw"],["F","B","Fw","Bw"]],cubesuff);
 }
 else if(type=="666p"){			// 6x6x6 (prefix)
  megascramble([["U","D","2U","2D","3U"],["R","L","2R","2L","3R"],["F","B","2F","2B","3F"]],cubesuff);
 }
 else if(type=="666s"){			// 6x6x6 (suffix)
  megascramble([["U","D","U&sup2;","D&sup2;","U&sup3;"],["R","L","R&sup2;","L&sup2;","R&sup3;"],["F","B","F&sup2;","B&sup2;","F&sup3;"]],cubesuff);
 }
 else if(type=="666si"){		// 6x6x6 (SiGN)
  megascramble([["U","D","u","d","3u"],["R","L","r","l","3r"],["F","B","f","b","3f"]],cubesuff);
 }
 else if(type=="777p"){			// 7x7x7 (prefix)
  megascramble([["U","D","2U","2D","3U","3D"],["R","L","2R","2L","3R","3L"],["F","B","2F","2B","3F","3B"]],cubesuff);
 }
 else if(type=="777s"){			// 7x7x7 (suffix)
  megascramble([["U","D","U&sup2;","D&sup2;","U&sup3;","D&sup3;"],["R","L","R&sup2;","L&sup2;","R&sup3;","L&sup3;"],["F","B","F&sup2;","B&sup2;","F&sup3;","B&sup3;"]],cubesuff);
 }
 else if(type=="777si"){		// 7x7x7 (SiGN)
  megascramble([["U","D","u","d","3u","3d"],["R","L","r","l","3r","3l"],["F","B","f","b","3f","3b"]],cubesuff);
 }
 else if(type=="clk"){			// Clock (Jaap order)
  for(var n=0;n<num;n++){
   ss[n]="<tt><b><br>&nbsp;UU"+c("u")+"dU"+c("u")+"dd"+c("u")+"Ud"+c("u")+"dU"+c("u")+"Ud"+c("u")+"UU"+c("u")+"UU";
   ss[n]+=c("u")+"UU"+c("u")+"dd"+c3()+c2()+"<br>&nbsp;dd"+c("d")+"dU"+c("d")+"UU"+c("d")+"Ud"+c("d");
   ss[n]+="UU"+c3()+"UU"+c3()+"Ud"+c3()+"dU"+c3()+"UU"+c3()+"dd"+c("d")+c2()+"</b></tt><br>";
  }
 }
 else if(type=="clkc"){			// Clock (concise)
  for(var n=0;n<num;n++){
   ss[n]="";
   for (var i=0;i<4;i++) ss[n]+="(" + (Math.floor(Math.random()*12)-5) + ", " + (Math.floor(Math.random()*12)-5) + ") / ";
   for (var i=0;i<6;i++) ss[n]+="(" + (Math.floor(Math.random()*12)-5) + ") / ";
   for (var i=0;i<4;i++) ss[n]+=rndEl(["d","U"]);
  }
 }
 else if(type=="clke"){			// Clock (efficient order)
  for(var n=0;n<num;n++){
   ss[n]="<tt><b><br>&nbsp;UU"+c("u")+"dU"+c("u")+"dU"+c("u")+"UU"+c("u")+"UU"+c("u")+"UU"+c("u")+"Ud"+c("u")+"Ud";
   ss[n]+=c("u")+"dd"+c("u")+"dd"+c3()+c2()+"<br>&nbsp;UU"+c3()+"UU"+c3()+"dU"+c("d")+"dU"+c3()+"dd";
   ss[n]+=c("d")+"Ud"+c3()+"Ud"+c("d")+"UU"+c3()+"UU"+c("d")+"dd"+c("d")+c2()+"</b></tt><br>";
  }
 }
 else if(type=="cm3"){			// Cmetrick
  megascramble([[["U<","U>","U2"],["E<","E>","E2"],["D<","D>","D2"]],[["R^","Rv","R2"],["M^","Mv","M2"],["L^","Lv","L2"]]],[""]);
 }
 else if(type=="cm2"){			// Cmetrick Mini
  megascramble([[["U<","U>","U2"],["D<","D>","D2"]],[["R^","Rv","R2"],["L^","Lv","L2"]]],[""]);
 }
 else if(type=="223"){			// Domino/2x3x3
  megascramble([[["U","U'","U2"]],["R2","L2"],["F2","B2"]],[""]);
 }
 else if(type=="flp"){			// Floppy Cube
  megascramble([["R","L"],["U","D"]],["2"]);
 }
 else if(type=="fto"){			// FTO/Face-Turning Octa
  megascramble([["U","D"],["F","B"],["L","BR"],["R","BL"]],["","'"]);
 }
 else if(type=="mgmo"){			// Megaminx (old style)
  oldminxscramble();
 }
 else if(type=="mgmp"){			// Megaminx (Pochmann)
  pochscramble(10,Math.ceil(len/10));
 }
 else if(type=="pyrm"){			// Pyraminx (random moves)
  megascramble([["U"],["L"],["R"],["B"]],["!","'"]);
  for(var n=0;n<num;n++){
   var cnt=0;
   var rnd=[];
   for(var i=0;i<4;i++){
    rnd[i]=Math.floor(Math.random()*3);
    if(rnd[i]>0) cnt++;
   }
   ss[n]=ss[n].substr(0,ss[n].length-3*cnt);
   ss[n]=["","b ","b' "][rnd[0]]+["","l ","l' "][rnd[1]]+["","u ","u' "][rnd[2]]+["","r ","r' "][rnd[3]]+ss[n];
   ss[n]=ss[n].replace(/!/g,"");
  }
 }
 else if(type=="pyro"){			// Pyraminx (optimal random state)
  getpyraoptscramble();
 }
 else if(type=="prco"){			// Pyraminx Crystal (old style)
  megascramble([["F","B"],["U","D"],["L","DBR"],["R","DBL"],["BL","DR"],["BR","DL"]],["","'","2","2'"]);
 }
 else if(type=="prcp"){			// Pyraminx Crystal (Pochmann)
  pochscramble(10,Math.ceil(len/10));
 }
 else if(type=="r234"){			// 2x2x2 3x3x3 4x4x4 relay
  ss[0] = "<br>";
  get2x2optscramble();
  ss[0] += "<br>";
  len = 25;
  megascramble([["U","D"],["R","L"],["F","B"]],cubesuff);
  ss[0] += "<br>";
  len = 40;
  megascramble([["U","D","u"],["R","L","r"],["F","B","f"]],cubesuff);
 }
 else if(type=="r2345"){		// 2x2x2 3x3x3 4x4x4 5x5x5 relay
  ss[0] = "<br>";
  get2x2optscramble();
  ss[0] += "<br>";
  len = 25;
  megascramble([["U","D"],["R","L"],["F","B"]],cubesuff);
  ss[0] += "<br>";
  len = 40;
  megascramble([["U","D","u"],["R","L","r"],["F","B","f"]],cubesuff);
  ss[0] += "<br>";
  len = 60;
  megascramble([["U","D","u","d"],["R","L","r","l"],["F","B","f","b"]],cubesuff);
 }
 else if(type=="r3"){			// multiple 3x3x3 relay
  var ncubes = len;
  len = 25;
  for (var i=0; i<ncubes; i++) {
   ss[0] += "<br>" + (i+1) + ") ";
   megascramble([["U","D"],["R","L"],["F","B"]],cubesuff);
  }
  len = ncubes;
 }
 else if(type=="sia113"){		// Siamese Cube (1x1x3 block)
  var n,s=[];
  megascramble([["U","u"],["R","r"]],cubesuff);
  for(n=0;n<num;n++){ss[n]+=" z2 ";}
  megascramble([["U","u"],["R","r"]],cubesuff);
 }
 else if(type=="sia123"){		// Siamese Cube (1x2x3 block)
  var n,s=[];
  megascramble([["U"],["R","r"]],cubesuff);
  for(n=0;n<num;n++){ss[n]+=" z2 ";}
  megascramble([["U"],["R","r"]],cubesuff);
 }
 else if(type=="sia222"){		// Siamese Cube (2x2x2 block)
  var n,s=[];
  megascramble([["U"],["R"],["F"]],cubesuff);
  for(n=0;n<num;n++){ss[n]+=" z2 y ";}
  megascramble([["U"],["R"],["F"]],cubesuff);
 }
 else if(type=="skb"){			// Skewb
  megascramble([["R"],["L"],["B"],["U"]],["","'"]);
 }
 else if(type=="sq1h"){			// Square-1 (turn metric)
  sq1_scramble(1);
 }
 else if(type=="sq1t"){			// Square-1 (twist metric)
  sq1_scramble(0);
 }
 else if(type=="sq2"){			// Square-2
  var i;
  for(var n=0;n<num;n++){
   i=0;
   while (i<len) {
    var rndu = Math.floor(Math.random()*12)-5;
    var rndd = Math.floor(Math.random()*12)-5;
    if (rndu != 0 || rndd != 0) {
     i++;
     ss[n] += "(" + rndu + "," + rndd + ") / ";
    }
   }
  }
 }
 else if(type=="sfl"){			// Super Floppy Cube
  megascramble([["R","L"],["U","D"]],cubesuff);
 }
 else if(type=="ssq1t"){		// Super Square-1 (twist metric)
  ssq1t_scramble();
 }
 else if(type=="ufo"){			// UFO
  megascramble([["A"],["B"],["C"],[["U","U'","U2'","U2","U3"]]],[""]);
 }
 else if(type=="2gen"){			// 2-generator <R,U>
  megascramble([["U"],["R"]],cubesuff);
 }
 else if(type=="roux"){			// Roux-generator <M,U>
  megascramble([["U"],["M"]],cubesuff);
 }
 else if(type=="3gen_F"){		// 3-generator <F,R,U>
  megascramble([["U"],["R"],["F"]],cubesuff);
 }
 else if(type=="3gen_L"){		// 3-generator <R,U,L>
  megascramble([["U"],["R","L"]],cubesuff);
 }
 else if(type=="RrUu"){			// <R,r,U,u>
  megascramble([["U","u"],["R","r"]],cubesuff);
 }
 else if(type=="bsq"){			// Bandaged Square-1 </,(1,0)>
  sq1_scramble(2);
 }
 else if(type=="half"){			// 3x3x3 half turns
  megascramble([["U","D"],["R","L"],["F","B"]],["2"]);
 }
 else if(type=="lsll"){			// 3x3x3 last slot + last layer
  megascramble([[["R U R'","R U2 R'","R U' R'"]],[["F' U F","F' U2 F","F' U' F"]],[["U","U2","U'"]]],[""]);
 }
 else if(type=="-1"){			// -1x-1x-1 (micro style)
  for(var n=0;n<num;n++){
   for(var i=0;i<len;i++){ss[n]+=String.fromCharCode(32+Math.floor(Math.random()*224));}
   ss[n]+="Error: subscript out of range";
  }
 }
 else if(type=="112"){			// 1x1x2
  megascramble([["R"],["R"]],cubesuff);
 }
 else if(type=="333noob"){		// 3x3x3 for noobs
  megascramble([["turn the top face","turn the bottom face"],["turn the right face","turn the left face"],["turn the front face","turn the back face"]],[" clockwise by 90 degrees,", " counterclockwise by 90 degrees,"," by 180 degrees,"]);
  for(var n=0;n<num;n++){
   ss[n]=ss[n].replace(/t/,"T");
   ss[n]=ss[n].substr(0,ss[n].length-2)+".";
  }
 }
 else if(type=="lol"){			// LOL
  megascramble([["L"],["O"]],[""]);
  for(var n=0;n<num;n++){ss[n]=ss[n].replace(/ /g,"");}
 }
 else if(type=="eide"){			// Derrick Eide
  megascramble([["OMG"],["WOW"],["WTF"],[["WOO-HOO","WOO-HOO","MATYAS","YES","YES","YAY","YEEEEEEEEEEEES"]],["HAHA"],["XD"],[":D"],["LOL"]],["","","","!!!"]);
 }
 scramble = ss[0];
 return scramble + " &nbsp; <span onclick='getlastscramble()' class='a'>get last scramble<\/span>";
}

// Clock functions.
function c(s){
 var array=[s+"&nbsp;&nbsp;",s+"'&nbsp;",s+"2'",s+"3'",s+"4'",s+"5'",s+"6&nbsp;",s+"5&nbsp;",s+"4&nbsp;",s+"3&nbsp;",s+"2&nbsp;","&nbsp;&nbsp;&nbsp;"];
 return " </b>"+rndEl(array)+"<b>&nbsp;&nbsp; ";
}
function c2(){return rndEl(["U","d"])+rndEl(["U","d"]);}
function c3(){return "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"}

function pochscramble(x,y){
 var i,j,n;
 for(n=0;n<num;n++){
  for(i=0;i<y;i++){
   ss[n]+="<br>&nbsp;&nbsp;";
   for(j=0;j<x;j++){
    ss[n]+=(j%2==0?"R":"D")+rndEl(["++","--"])+" ";
   }
   ss[n]+="U"+rndEl(["'"," "]);
  }
 }
}

function sq1_scramble(type){
 seq=[];
 var i,k,n;
 sq1_getseq(num, type);
 for(n=0;n<num;n++){
  var s="";
  for(i=0; i<seq[n].length; i++){
   k=seq[n][i];
   if(k[0] == 7) {
    s +="/";
   } else {
    s += " (" + k[0] + "," + k[1] + ") ";
   }
  }
  ss[n]+=s;
 }
}

function ssq1t_scramble(){
 seq=[];
 var i,n;
 sq1_getseq(num*2, 0);
 for(n=0;n<num;n++){
  var s=seq[2*n],t=seq[2*n+1],u="",k;
  if (s[0][0]==7) s=[[0,0]].concat(s);
  if (t[0][0]==7) t=[[0,0]].concat(t);
  for(i=0;i<len;i++){
   u+="(" + s[2*i][0] + "," + t[2*i][0] + "," + t[2*i][1] + "," + s[2*i][1] + ") / ";
  }
  ss[n]+=u;
 }
}

function sq1_getseq(num, type){
 for(var n=0; n<num; n++){
  p = [1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0];
  seq[n] = [];
  var cnt = 0;
  while (cnt < len) {
   var x = Math.floor(Math.random() * 12) - 5;
   var y = (type==2) ? 0 : Math.floor(Math.random() * 12) - 5;
   var size = (x==0?0:1) + (y==0?0:1);
   if ((cnt + size <= len || type != 1) && (size > 0 || cnt == 0)) {
    if (sq1_domove(x, y)) {
     if (type == 1) cnt += size;
     if (size > 0) seq[n][seq[n].length] = [x,y];
     if (cnt < len || type != 1) {
      cnt++;
      seq[n][seq[n].length] = [7,0];
      sq1_domove(7,0);
     }
    }
   }
  }
 }
}

function sq1_domove(x, y){
 var i, temp, px, py;
 if (x == 7) {
  for (i=0; i<6; i++) {
   temp = p[i+6];
   p[i+6] = p[i+12];
   p[i+12] = temp;
  }
  return true;
 } else {
  if (p[(17-x)%12] || p[(11-x)%12] || p[12+(17-y)%12] || p[12+(11-y)%12]) {
   return false;
  } else {
   // do the move itself
   px = p.slice(0, 12);
   py = p.slice(12, 24);
   for (i=0; i<12; i++) {
    p[i] = px[(12+i-x)%12];
    p[i+12] = py[(12+i-y)%12];
   }
   return true;
  }
 }
}

function oldminxscramble(){
 var i,j,k;
 var faces = ["F","B","U","D","L","DBR","DL","BR","DR","BL","R","DBL"];
 var suff = ["","2","2'","'"];
 var used = [];
 // adjacency table
 var adj = ["001010101010","000101010101","100010010110","010001101001","101000100101","010100011010","100110001001","011001000110","100101100010","011010010001","101001011000","010110100100"];
 // now generate the scramble(s)
 for(i=0;i<num;i++){
  var s="";
  for(j=0;j<12;j++){
   used[j] = 0;
  }
  for(j=0;j<len;j++){
   var done = false;
   do {
    var face = Math.floor(Math.random()*12);
    if (used[face] == 0) {
     s += faces[face] + rndEl(suff) + " ";
     for(k=0;k<12;k++){
      if (adj[face].charAt(k)=="1") {used[k] = 0;}
     }
     used[face] = 1;
     done = true;
    }
   } while (!done);
  }
  ss[i] += s;
 }
}

// Function written by Tom van der Zanden/Jaap Scherphuis and optimized/obfuscated/condensed by me
function get2x2optscramble() {
 var s,e=[15,16,16,21,21,15,13,9,9,17,17,13,14,20,20,4,4,14,12,5,5,8,8,12,3,23,23,18,18,3,1,19,19,11,11,1,2,6,6,22,22,2,0,10,10,7,7,0],d=[[],[],[],[],[],[]],v=[[0,2,3,1,23,19,10,6,22,18,11,7],[4,6,7,5,12,20,2,10,14,22,0,8],[8,10,11,9,12,7,1,17,13,5,0,19],[12,13,15,14,8,17,21,4,9,16,20,5],[16,17,19,18,15,9,1,23,13,11,3,21],[20,21,23,22,14,16,3,6,15,18,2,4]],r=[],a=[],b=[],c=[],f=[],s=[];function t(){s=[1,1,1,1,2,2,2,2,5,5,5,5,4,4,4,4,3,3,3,3,0,0,0,0]}t();function mx(){t();for(var i=0;i<500;i++)dm(Math.floor(Math.random()*3+3)+16*Math.floor(Math.random()*3))}function cj(){var i,j;for(i=0;i<6;i++)for(j=0;j<6;j++)d[i][j]=0;for(i=0;i<48;i+=2)if(s[e[i]]<=5&&s[e[i+1]]<=5)d[s[e[i]]][s[e[i+1]]]++}function dm(m){var j=1+(m>>4),k=m&15,i;while(j){for(i=0;i<v[k].length;i+=4)y(s,v[k][i],v[k][i+3],v[k][i+2],v[k][i+1]);j--}}function sv(){cj();var h=[],w=[],i=0,j,k,m;for(j=0;j<7;j++){m=0;for(k=i;k<i+6;k+=2){if(s[e[k]]==s[e[42]])m+=4;if(s[e[k]]==s[e[44]])m+=1;if(s[e[k]]==s[e[46]])m+=2}h[j]=m;if(s[e[i]]==s[e[42]]||s[e[i]]==5-[s[e[42]]])w[j]=0;else if(s[e[i+2]]==s[e[42]]||s[e[i+2]]==5-[s[e[42]]])w[j]=1;else w[j]=2;i+=6}m=0;for(i=0;i<7;i++){j=0;for(k=0;k<7;k++){if(h[k]==i)break;if(h[k]>i)j++}m=m*(7-i)+j}j=0;for(i=5;i>=0;i--)j=j*3+w[i]-3*Math.floor(w[i]/3);if(m!=0||j!=0){r.length=0;for(k=0;k<100;k++)if(se(0,m,j,k,-1))break;j="";for(m=0;m<r.length;m++)j="URF".charAt(r[m]/10)+"\'2 ".charAt(r[m]%10)+" "+j;return j}}function se(i,j,k,l,m){if(l!=0){if(a[j]>l||b[k]>l)return false;var o,p,q,n;for(n=0;n<3;n++)if(n!=m){o=j;p=k;for(q=0;q<3;q++){o=c[o][n];p=f[p][n];r[i]=10*n+q;if(se(i+1,o,p,l-1,n))return true}}}else if(j==0&&k==0)return true;return false}function z(){var i,j,k,m,n;for(i=0;i<5040;i++){a[i]=-1;c[i]=[];for(j=0;j<3;j++)c[i][j]=g(i,j)}a[0]=0;for(i=0;i<=6;i++)for(j=0;j<5040;j++)if(a[j]==i)for(k=0;k<3;k++){m=j;for(n=0;n<3;n++){var m=c[m][k];if(a[m]==-1)a[m]=i+1}}for(i=0;i<729;i++){b[i]=-1;f[i]=[];for(j=0;j<3;j++)f[i][j]=w(i,j)}b[0]=0;for(i=0;i<=5;i++)for(j=0;j<729;j++)if(b[j]==i)for(k=0;k<3;k++){m=j;for(n=0;n<3;n++){var m=f[m][k];if(b[m]==-1)b[m]=i+1}}}function g(i,j){var k,m,n,o=i,h=[];for(k=1;k<=7;k++){m=o%k;o=(o-m)/k;for(n=k-1;n>=m;n--)h[n+1]=h[n];h[m]=7-k}if(j==0)y(h,0,1,3,2);else if(j==1)y(h,0,4,5,1);else if(j==2)y(h,0,2,6,4);o=0;for(k=0;k<7;k++){m=0;for(n=0;n<7;n++){if(h[n]==k)break;if(h[n]>k)m++}o=o*(7-k)+m}return o}function w(i,j){var k,m,n,o=0,p=i,h=[];for(k=0;k<=5;k++){n=Math.floor(p/3);m=p-3*n;p=n;h[k]=m;o-=m;if(o<0)o+=3}h[6]=o;if(j==0)y(h,0,1,3,2);else if(j==1){y(h,0,4,5,1);h[0]+=2;h[1]++;h[5]+=2;h[4]++}else if(j==2){y(h,0,2,6,4);h[2]+=2;h[0]++;h[4]+=2;h[6]++}p=0;for(k=5;k>=0;k--)p=p*3+(h[k]%3);return p}function y(i,j,k,m,n){var o=i[j];i[j]=i[k];i[k]=i[m];i[m]=i[n];i[n]=o}z();
 for (var i=0;i<num;i++) {
  mx();
  ss[i]+=sv();
 }
}

// Function written by Lucas Garron/Jaap Scherphuis and optimized/obfuscated/condensed by me
function getpyraoptscramble() {
 var j=1,b=[],g=[],f=[],d=[],e=[],k=[],h=[],i=[];function u(){var c,p,q,l,m;for(p=0;p<720;p++){g[p]=-1;d[p]=[];for(m=0;m<4;m++)d[p][m]=w(p,m)}g[0]=0;for(l=0;l<=6;l++)for(p=0;p<720;p++)if(g[p]==l)for(m=0;m<4;m++){q=p;for(c=0;c<2;c++){q=d[q][m];if(g[q]==-1)g[q]=l+1}}for(p=0;p<2592;p++){f[p]=-1;e[p]=[];for(m=0;m<4;m++)e[p][m]=x(p,m)}f[0]=0;for(l=0;l<=5;l++)for(p=0;p<2592;p++)if(f[p]==l)for(m=0;m<4;m++){q=p;for(c=0;c<2;c++){q=e[q][m];if(f[q]==-1)f[q]=l+1}}for(c=0;c<j;c++){k=[];var t=0,s=0;q=0;h=[0,1,2,3,4,5];for(m=0;m<4;m++){p=m+n(6-m);l=h[m];h[m]=h[p];h[p]=l;if(m!=p)s++}if(s%2==1){l=h[4];h[4]=h[5];h[5]=l}s=0;i=[];for(m=0;m<5;m++){i[m]=n(2);s+=i[m]}i[5]=s%2;for(m=6;m<10;m++){i[m]=n(3)}for(m=0;m<6;m++){l=0;for(p=0;p<6;p++){if(h[p]==m)break;if(h[p]>m)l++}q=q*(6-m)+l}for(m=9;m>=6;m--)t=t*3+i[m];for(m=4;m>=0;m--)t=t*2+i[m];if(q!=0||t!=0)for(m=0;m<12;m++)if(v(q,t,m,-1))break;b[c]="";for(p=0;p<k.length;p++)b[c]+=["U","L","R","B"][k[p]&7]+["","'"][(k[p]&8)/8]+" ";var a=["l","r","b","u"];for(p=0;p<4;p++){q=n(3);if(q<2)b[c]+=a[p]+["","'"][q]+" "}}}function v(q,t,l,c){if(l==0){if(q==0&&t==0)return true}else{if(g[q]>l||f[t]>l)return false;var p,s,a,m;for(m=0;m<4;m++)if(m!=c){p=q;s=t;for(a=0;a<2;a++){p=d[p][m];s=e[s][m];k[k.length]=m+8*a;if(v(p,s,l-1,m))return true;k.length--}}}return false}function w(p,m){var a,l,c,s=[],q=p;for(a=1;a<=6;a++){c=Math.floor(q/a);l=q-a*c;q=c;for(c=a-1;c>=l;c--)s[c+1]=s[c];s[l]=6-a}if(m==0)y(s,0,3,1);if(m==1)y(s,1,5,2);if(m==2)y(s,0,2,4);if(m==3)y(s,3,4,5);q=0;for(a=0;a<6;a++){l=0;for(c=0;c<6;c++){if(s[c]==a)break;if(s[c]>a)l++}q=q*(6-a)+l}return q}function x(p,m){var a,l,c,t=0,s=[],q=p;for(a=0;a<=4;a++){s[a]=q&1;q>>=1;t^=s[a]}s[5]=t;for(a=6;a<=9;a++){c=Math.floor(q/3);l=q-3*c;q=c;s[a]=l}if(m==0){s[6]++;if(s[6]==3)s[6]=0;y(s,0,3,1);s[1]^=1;s[3]^=1}if(m==1){s[7]++;if(s[7]==3)s[7]=0;y(s,1,5,2);s[2]^=1;s[5]^=1}if(m==2){s[8]++;if(s[8]==3)s[8]=0;y(s,0,2,4);s[0]^=1;s[2]^=1}if(m==3){s[9]++;if(s[9]==3)s[9]=0;y(s,3,4,5);s[3]^=1;s[4]^=1}q=0;for(a=9;a>=6;a--)q=q*3+s[a];for(a=4;a>=0;a--)q=q*2+s[a];return q}function y(p,a,c,t){var s=p[a];p[a]=p[c];p[c]=p[t];p[t]=s}function n(c){return Math.floor(Math.random()*c)}
 u();
 ss[0]+=b[0];
}

/* Function by Kas Thomas, http://www.planetpdf.com/developer/article.asp?ContentID=testing_for_object_types_in_ja */
function isArray(obj){
 if(typeof obj=='object'){
  var test = obj.constructor.toString().match(/array/i); 
  return (test != null);
  }
 return false;
}

function megascramble(turns, suffixes){
 var donemoves=[];
 var lastaxis;
 var i,j,k;
 for(i=0;i<num;i++){
  var s="";
  lastaxis=-1;
  for(j=0;j<len;j++){
   var done=0;
   do{
    var first=Math.floor(Math.random()*turns.length);
    var second=Math.floor(Math.random()*turns[first].length);
    if(first!=lastaxis||donemoves[second]==0){
     if(first==lastaxis){
      donemoves[second]=1;
      if(isArray(turns[first][second])){
       s+=rndEl(turns[first][second])+rndEl(suffixes)+" ";
      }else{
       s+=turns[first][second]+rndEl(suffixes)+" ";
      }
     }else{
      for(k=0;k<turns[first].length;k++){donemoves[k]=0;}
      lastaxis=first;
      donemoves[second]=1;
      if(isArray(turns[first][second])){
       s+=rndEl(turns[first][second])+rndEl(suffixes)+" ";
      }else{
       s+=turns[first][second]+rndEl(suffixes)+" ";
      }
     }
     done=1;
    }
   }while(done==0);
  }
  ss[i]+=s;
 }
}

// -->
 </script>
</head><div firebugcommandlineattached="true" firebugversion="1.5.3" 
style="display: none;" id="_firebugConsole"></div><body 
onload="initialize()" onkeyup="startTimer(event.keyCode);" 
onkeydown="checkKey(event.keyCode);">
 <table width="100%" border="1" cellpadding="5" cellspacing="0">
  <tbody><tr>
   <td colspan="3" id="menu" bgcolor="#00ff00">
    <table width="100%" cellpadding="2" cellspacing="0">
     <tbody><tr>
      <td>
       <font face="Arial" size="3">Scramble type:</font>
       <select id="optbox" size="1" onchange="rescramble();"><option 
value="">===WCA PUZZLES===</option><option value="">2x2x2</option><option
 selected="selected" value="">3x3x3</option><option value="">4x4x4</option><option
 value="">5x5x5</option><option value="">6x6x6</option><option value="">7x7x7</option><option
 value="">Clock</option><option value="">Megaminx</option><option 
value="">Pyraminx</option><option value="">Square-1</option><option 
value="">===OTHER PUZZLES===</option><option value="">1x3x3 (Floppy 
Cube)</option><option value="">2x3x3 (Domino)</option><option value="">3x3x4</option><option
 value="">3x3x5</option><option value="">Cmetrick</option><option 
value="">Cmetrick Mini</option><option value="">Domino (2x3x3)</option><option
 value="">Floppy Cube (1x3x3)</option><option value="">FTO (Face-Turning
 Octahedron)</option><option value="">Pyraminx Crystal</option><option 
value="">Siamese Cube (1x1x3 block)</option><option value="">Siamese 
Cube (1x2x3 block)</option><option value="">Siamese Cube (2x2x2 block)</option><option
 value="">Skewb</option><option value="">Square-2</option><option 
value="">Super Floppy Cube</option><option value="">Super Square-1</option><option
 value="">UFO</option><option value="">===SPECIALTY SCRAMBLES===</option><option
 value="">1x1x1</option><option value="">3x3x3 subsets</option><option 
value="">Bandaged Square-1 &lt;/,(1,0)&gt;</option><option value="">Bigcube
 subsets</option><option value="">Relays</option><option value="">===JOKE
 SCRAMBLES===</option><option value="">-1x-1x-1 (micro style)</option><option
 value="">1x1x2</option><option value="">3x3x3 for noobs</option><option
 value="">LOL</option><option value="">Derrick Eide</option></select>
       <select id="optbox2" size="1" onchange="rescramble2();"><option 
selected="selected" value="333">old style</option></select>
      </td>
      <td>
       <font face="Arial" size="3">Scramble length:</font><input 
value="25" id="leng" size="3" maxlength="3" onchange="rescramble3();">
      </td>
      <td><a href="http://mzrg.com/qqtimer/megadoc.html" target="_blank"
 style="color: black;">Help!</a></td>
     </tr>
    </tbody></table>
   </td>
  </tr>
  <tr>
   <td colspan="3">
    <span id="scramble">scramble: U' R2 L2 D2 U2 R F R' D U' L' F' D U2 
B2 U R' D' F' L2 F R L F U  &nbsp; <span onclick="getlastscramble()" 
class="a">get last scramble</span></span>
   </td>
  </tr>
  <tr>
   <td align="center">
    <span id="showOpt" onclick="toggleOptions()" class="a">show</span> 
timer options<br>
    <span id="theTime" style="font-size: 1em; font-family: Sans-Serif; 
font-weight: bold; color: black;">3.349</span><br>
    that time was: <span onclick="changeNotes(0);" class="a">no penalty</span>
 <span onclick="changeNotes(2);" class="a">+2</span> <span 
onclick="changeNotes(1);" class="a">DNF</span> | <span 
onclick="comment();" class="a">leave comment</span>
   </td>
   <td style="width: 15em;">
    <div id="theList" style="overflow-y: scroll; height: 16em;">times (<span
 onclick="resetTimes();" class="a">reset</span>):<br><span 
onclick="del(0);" class="b">2.753</span>, <span onclick="del(1);" 
class="b">3.318</span>, <span onclick="del(2);" class="b">1.241</span>, <span
 onclick="del(3);" class="b">4.129</span>, <span onclick="del(4);" 
class="b">2.820</span>, <span onclick="del(5);" class="b">3.382</span>, <span
 onclick="del(6);" class="b">2.302</span>, <span onclick="del(7);" 
class="b">3.270</span>, <span onclick="del(8);" class="b">2.798</span>, <span
 onclick="del(9);" class="b">2.972</span>, <span onclick="del(10);" 
class="b">3.349</span> </div>
   </td>
   <td style="width: 15em;">
    <div id="stats" style="overflow-y: scroll; height: 16em;">stats: (<span
 id="hidestats" onclick="toggleStatView()" class="a">hide</span>)<br>number
 of times: 11/11<br>best time: <span 
onclick="setHighlight(2,1,0);loadList();" class="a">1.241</span><br>worst
 time: <span onclick="setHighlight(3,1,1);loadList();" class="a">4.129</span><br><br>current
 avg5: <span onclick="setHighlight(6,5,51);loadList();" class="a">3.013</span>
 (σ = 0.19)<br>best avg5: <span 
onclick="setHighlight(2,5,50);loadList();" class="a">2.835</span> (σ = 
0.44)<br><br>session avg: <span 
onclick="setHighlight(0,11,2);loadList();" class="a">2.996</span> (σ = 
0.34)<br>session mean: 2.939</div>
   </td>
  </tr>
  <tr id="options" style="display: none;">
   <td colspan="3">
    turn timer updating <span id="toggler" onclick="toggleTimer()" 
class="a">on (by seconds)</span><br>
    display time to <span id="millisec" onclick="toggleMilli()" 
class="a">1/100 sec</span><br>
    enter in times <span id="inputTimes" onclick="toggleInput()" 
class="a">manually</span><br>
    <span onclick="increaseSize()" class="a">increase</span>/<span 
onclick="decreaseSize()" class="a">decrease</span> timer size<br>
    use <span id="inspec" onclick="toggleInspection()" class="a">WCA</span>
 inspection<br>
    <span id="mean3" onclick="toggleMean3()" class="a">use</span> mean 
of 3<br>
    <span id="colorz">top bar color: #<input id="topcol" value="00ff00" 
size="6" maxlength="6"> <span onclick="changeColor()" class="a">set</span><br>
    <span id="icolor" onclick="invertColor()" class="a">invert colors</span>
   </span></td>
  </tr>
  <tr id="avgdata" style="display: none;">
  </tr>
  <tr id="import" style="display: none;">
  </tr>
 </tbody></table>
 
 <form id="statform" method="POST">
 User (email) <input type="text" name="email"/>
 Password <input type="password" name="password"/>
 Mode <select name="mode">
    <option value="Normal">Normal</option>
    <option value="One Handed">One Handed</option>
    <option value="Fewest Moves">Fewest Moves</option>
    <option value="Blind Folded">Blind Folded</option>    
 </select>
 <input type="hidden" name="start"/>
 <input type="hidden" name="puzzle"/>
 <input type="hidden" name="times"/>
 <input type="hidden" name="best_time"/>
 <input type="hidden" name="worst_time"/> 
 <input type="hidden" name="avg5"/>
 <input type="hidden" name="avg12"/> 
 <input type="hidden" name="avg5_sd"/>
 <input type="hidden" name="avg12_sd"/>
 <input type="hidden" name="scrambles"/>
 <input type="hidden" name="comments"/>
 <input id="pre-export" type="submit" name="Export" value="Save"/> 
 </form>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js" type="text/javascript"></script>
<script type="text/javascript">


$(document).ready(function(){
    
    $('#pre-export').click(function (){        
        startTime_str = [startTime.getFullYear(), '-', startTime.getMonth(), '-', startTime.getDate(),' ', startTime.getHours(), ':', startTime.getMinutes(), ':', startTime.getSeconds()]
        //currTime_str = [currTime.getFullYear(), '-', currTime.getMonth(), '-', currTime.getDate(),' ', currTime.getHours(), ':', currTime.getMinutes(), ':', currTime.getSeconds()]
        $('input[name=start]').val(startTime_str.join(''));
        $('input[name=puzzle]').val($('#optbox option:selected').html());
        $('input[name=times]').val(times);
        $('input[name=best_time]').val(bestTime);
        $('input[name=worst_time]').val(worstTime);
        $('input[name=avg5]').val(bestAvg[1][0]);
        $('input[name=avg12]').val(bestAvg[2][0]);
        $('input[name=avg5_sd]').val(bestAvg[1][1]);
        $('input[name=avg12_sd]').val(bestAvg[2][1]);
        $('input[name=scrambles]').val(scrambleArr);
        $('input[name=comments]').val(comments);        
        
        //return false;
        });
        
    $('#statform').submit(function(){
        var submit = confirm('Are you sure to submit? This will reset all your time.');
        if (submit == true) {
            window.open('', 'result_window');
            this.target = 'result_window';
            //location.reload(true);
            }
        else {
            return false;
            }
        });
    
    });
    
</script>
</body><script id="_firebugCommandLineInjector" type="text/javascript">/* See license.txt for terms of usage */

var _FirebugCommandLine =
{
    initFirebugCommandLine: function()
    {
        // Define console functions.
        var commands = ["$", "$$", "$x", "$n", "cd", "clear", "inspect", "keys",
            "values", "debug", "undebug", "monitor", "unmonitor", "traceCalls", "untraceCalls",
            "traceAll", "untraceAll", "monitorEvents", "unmonitorEvents", "profile", "profileEnd", "copy"];
        for (var i=0; i<commands.length; i++)
        {
            var command = commands[i];

            // If the method is already defined, don't override it.
            if (window[command])
                continue;

            this[command] = new Function(
                "return window.console.notifyFirebug(arguments, '" + command + "', 'firebugExecuteCommand');");
        }

        // Define console shortcuts
        var consoleShortcuts = ["dir", "dirxml"];
        for (var i=0; i<consoleShortcuts.length; i++)
        {
            var command = consoleShortcuts[i];
            this[command] = new Function("return window.console." + command + ".apply(window.console, arguments)");
        }

        // Define console variables.
        var props = ["$0", "$1"];
        for (var j=0; j<props.length; j++)
        {
            var prop = props[j];
            if (window[prop])
                continue;

            this.__defineGetter__(prop, new Function(
                "return window.console.notifyFirebug(arguments, '" + prop + "', 'firebugExecuteCommand');"));
        }

        this.attachCommandLine();
    },

    attachCommandLine: function()
    {
        // DBG window.dump("attachCommandLine "+window.location+"\n");
        if (!window.console)
        {
            // DBG 	debugger;
            window.loadFirebugConsole();
        }
        var element = window.console.getFirebugElement();
        var self = this;
        element.addEventListener("firebugCommandLine", function _firebugEvalEvent(event)
        {
            // DBG window.dump("attachCommandLine firebugCommandLine "+window.location+"\n");
            var element = event.target;
            var expr = element.getAttribute("expr"); // see commandLine.js
            self.evaluate(expr);
            // DBG window.dump("attachCommandLine did evaluate on "+expr+"\n");
        }, true);
        element.setAttribute("firebugCommandLineAttached", "true")
        // DBG window.dump("Added listener for firebugCommandLine event "+window.location+"\n");
    },

    evaluate: function(expr)
    {
        try
        {
            var result = window.eval(expr);
            if (typeof result != "undefined")
                window.console.notifyFirebug([result], "evaluated", "firebugAppendConsole");
        }
        catch(exc)
        {
            var result = exc;
            result.source = expr;
            window.console.notifyFirebug([result], "evaluateError", "firebugAppendConsole");
        }
    },
};

(function()
{
    try
    {
        // DBG window.dump("_FirebugCommandLine init console is "+window.console+" in "+window.location+"\n");
        _FirebugCommandLine.initFirebugCommandLine();
    }
    catch(exc)
    {
        var wrappedException = {
            cause: exc,
            message: "_FirebugCommandLine init failed in "+window.location+" because "+exc,
            toString: function() { return this.message; }
        };
        throw wrappedException;
    }
})();
</script></html>